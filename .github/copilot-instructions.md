# Copilot Instructions for EverLiving (EverTrace)

## Project Overview
- **Purpose:** Video, image, and memory management web app with user authentication, media uploads, and preview generation.
- **Architecture:**
  - **Backend:** Python Flask (see `src/app_restructured.py`)
  - **Frontend:** HTML/CSS/JS in `templates/` and `static/`
  - **Auth:** Custom session-based, logic in `src/auth_service.py`
  - **Media Processing:** Video/image/audio handled in `src/video_processor.py`, `src/generate_previews.py`, and music utilities.
  - **User Data:** Stored in `E:/EverLiving_UserData/{username}/` (do not modify manually).
  - **Config:** All settings in `config/` (notably `email_config.py` and `requirements.txt`).

## Key Workflows
- **Setup:**
  1. Activate venv: `.venv\Scripts\activate`
  2. Install deps: `pip install -r config/requirements.txt`
  3. Run: `python app.py` (entry point)
- **Web Access:** http://localhost:8080 (SPA, mobile-friendly)
- **Testing:** Manual via browser; some scripts in `tests/` for JS/HTML.
- **Debugging:**
  - Email codes shown in console (dev mode)
  - Session can be cleared at `/clear_session`

## Project Conventions & Patterns
- **User Folders:** All user uploads and generated content are in `E:/EverLiving_UserData/{username}/` (never touch directly).
- **Auth:** User DB is a JSON file at `E:/EverLiving_UserData/Danhsach_user.json`.
- **Media:**
  - Music: `assets/music/`
  - Outtro: `assets/outro/`
  - Previews: Generated by `src/generate_previews.py`
- **Routes:**
  - `/` = landing/login/register
  - `/main` = main app (after login)
- **Email:** Config in `config/email_config.py`. If missing, app runs in dev mode (no real email).
- **Session:** Flask session, 1 hour lifetime, not secure for production.
- **File Structure:**
  - `src/` = all backend logic
  - `templates/` = HTML
  - `static/` = CSS/JS/assets
  - `config/` = settings
  - `assets/` = media
  - `docs/` = documentation

## Integration & Extensibility
- **Add new media types:** Extend `video_processor.py` or add new modules in `src/`.
- **Add routes:** Use Flask blueprint or add to `app_restructured.py`.
- **External scripts:** Place in `scripts/`.

## Examples
- To add a new user field: update `auth_service.py` and user DB JSON schema.
- To add a new video processing step: extend `video_processor.py` and update relevant routes.

---
For more, see `docs/README.md` and comments in `src/app_restructured.py`.
